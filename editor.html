<html lang="en">
  <head>
  	<meta charset="UTF-8">
  	<meta name="description" content="Design Your Own Crypto Coin">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
	<meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta http-equiv="Cache-control" content="public">
	<meta name="apple-mobile-web-app-title" content="Stonk Starz">
    <meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="format-detection" content="telephone=no">
	<title>Gemmi</title>
	<link rel="shortcut icon" href="static/logo/gemmi.ico">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
	<!-- <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/> -->
	<link rel='stylesheet' href='static/stylesheets/style.css' />
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src='//ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.3.1/fabric.min.js" integrity="sha512-ACqMrfAtm537AWzgx/xQ57JnFxXeq8RylQMGg4y/e6M2ew4Z8NycE8aId/Bt2ZE+w1gNsox3MgwxKl7SGMRdtA==" crossorigin="anonymous"></script>
    <style>
    	@media only screen and (max-width:699px) {
    		.editor_container h1 {
    			font-size:1.6rem!important;
    		}
    		.canvas__toolbar__container {
    			width: 90%!important;
    		}
    		.canvas_container {
    			margin-left:revert!important;
    		}
    		.btn_toolbar {
	    		margin: 1rem 0!important;
	    	}
    		.fa-palette, .fa-pen-fancy, .fa-shapes {
				font-size:2rem!important;
			}
			.toggle {
				transform: scale(0.7)!important;
				left: -35%!important;
			}
    	}
    	.editor_container {
    		position: relative;
    		width: 100vw;
    		height: 100vh;
    	}
    	.editor_container h1 {
    		text-align: center;
    		text-shadow: 0 4px 8px rgba(0,0,0,0.5);
			background: -webkit-linear-gradient(to right, magenta , fuchsia, violet, black);
			background: -o-linear-gradient(to right, magenta , fuchsia, violet, black);
			background: -moz-linear-gradient(to right, magenta , fuchsia, violet, black);
			background: linear-gradient(to right, magenta , fuchsia, violet, black);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
    	}
    	.canvas__toolbar__container {
    		position: absolute;
    		top: 10%;
    		left: 0;
    		right: 0;
    		margin: 0 auto;
    		text-align: center;
			text-shadow: 0 4px 8px rgba(0,0,0,0.5);
			height: 50%;
			width: 50%;
			min-width: 310px;
			min-height: 300px;
			max-width: 700px;
    		max-height: 500px;
    	}
    	.toolbar__canvas {
    		display: inline-block;
    		width: 13%;
    		height: 500px;
    		background-color: transparent;
			text-shadow: 0 4px 8px rgba(0,0,0,0.7);
			z-index:20;
			/*border-radius:10px;*/
			/*box-shadow: 0px 20px 40px rgb(0,0,0,0.3);*/
			vertical-align: bottom
    	}
    	.canvas_container {
    		display: inline-block;
    		width: 85%;
    		height: 100%;
    		margin-left:0.5rem;
    		/*position: absolute;
    		top: 10%;
    		left: 0;
    		right: 0;
    		margin: 0 auto;
    		text-align: center;
			text-shadow: 0 4px 8px rgba(0,0,0,0.5);
			height: 50%;
			width: 50%;
			min-width: 260px;
			min-height: 300px;
			max-width: 600px;
    		max-height: 500px;*/
    	}
    	.btn_toolbar {
    		margin: 1rem 0;
    	}
    	.fa-palette, .fa-pen-fancy, .fa-shapes {
		  font-size:3rem
		}
    	#c1 {
    		border-radius: 10px;
    		filter: drop-shadow(0 4px 8px rgb(255, 255,255, 0.4));
    		box-shadow: 0px 20px 40px rgb(0,0,0,0.3);
    		transition: all 0.3s ease-in;
    		-webkit-transition: all 0.3s ease-in;
    	}
    	.background_toggle_switch_container {
    		position:relative;
    		margin-top: 1rem;
    	}
    	.off{
		  background-color: #000;
		  border-radius: 10px;
		  transition: all 0.3s ease-in;
		  -webkit-transition: all 0.3s ease-in;
		}
    	.dark{
		  background-color:black;
		}
		.lightSwitch{
		  background:rgb(0,0,0,0.8);
		  filter: drop-shadow(0px 5px 10px rgb(0,0,0, 0.4));
		  box-shadow: inset 0px 0px 10px 20px rgb(255, 255, 255, 0.1);
		}
		.lightTrack{
		  background:transparent;
		}
		.toggle{
		  position:absolute;
		  width:50px;
		  height:25px;
		  top:50%;
		  left:0;
		  right:0;
		  margin:0 auto;
		  text-align:center;
		  z-index:1;
		  border-radius:100px;
		  border: 0.4rem solid rgb(0,0,0,0.6);
		  filter: drop-shadow(0px 5px 10px rgb(0,0,0, 0.7));
		  box-shadow: inset 0px 0px 10px 20px rgb(255, 255, 255, 0.1);
		  opacity: 0.9;
		  transition: all 0.3s cubic-bezier(.95, .25, .30, .65);
		  -webkit-transition: all 0.3s cubic-bezier(.95, .25, .30, .65);
		}
		.check{
		  height:100%;
		  width:100%;
		  border-radius:50%;
		  cursor:pointer;
		  opacity:0;
		  margin:0px;
		  z-index:2;
		}
		.switch{
		  position:absolute;
		  top:5px;
		  left:5px;
		  height:17px;
		  width:17px;
		  border-radius:40px;
		  z-index:-1;
		  transition: all 0.3s cubic-bezier(.95, .25, .30, .65);
		  -webkit-transition: all 0.3s cubic-bezier(.95, .25, .30, .65);
		}
		.track{
		  position:absolute;
		  top:0px;
		  left:0px;
		  width:100%;
		  height:100%;
		  border-radius:40px;
		  z-index:-2;
		  transition: all 0.3s cubic-bezier(.95, .25, .30, .65);
		  -webkit-transition: all 0.3s cubic-bezier(.95, .25, .30, .65);
		}
		.light{
		  position:absolute;
		  top:-30px;
		  left:0;
		  right:0;
		  margin:0 auto;
		  width:10px;
		  height:10px;
		  border-radius:10px;
		  transition: all 0.3s cubic-bezier(.95, .25, .30, .65);
		  -webkit-transition: all 0.3s cubic-bezier(.95, .25, .30, .65);
		}
		.move{
		  transform: translate(30px); background:rgb(255,255,255,0.6);
		}
		.move + .track{
		  background:rgb(255,255,255, 0.1);
		  filter: drop-shadow(0px 5px 10px rgb(0,0,0, 0.7));
		  box-shadow: inset 0px 0px 10px 20px rgb(255, 255, 255, 0.1);
		}
		.toggle-border {
		  border: solid 0.4rem rgb(255,255,255,0.9);
		  filter: drop-shadow(0px 5px 10px rgb(255,255,255, 0.7));
		  box-shadow: inset 0px 0px 10px 20px rgb(0, 0, 0, 0.1);
		}
    </style>
  </head>
  <body>
  	<div class="header">
		<div class="logo_container">
			<div id="logo"></div>
			<div class="co_name">Gemmi</div>
		</div>
		<div class="header_right">
			<div class="contact_career_txt">Careers</div>
			<div class="contact_career_txt">Contact</div>
		</div>
	</div>
	<div class="editor_container">
		<h1>Design Your Crypto Coin</h1>
		<div class="canvas__toolbar__container">
			<div class="toolbar__canvas">
				<div id="btn_shapes" class="btn_toolbar">
					<i class="fas fa-shapes"></i>
				</div>
				<div id="btn_color_palette" class="btn_toolbar">
					<i class="fas fa-palette"></i>
				</div>
				<div id="btn_signature">
					<i class="fas fa-pen-fancy"></i>
				</div>
				<div class="background_toggle_switch_container" class="btn_toolbar">
				  <div id="toggle" class="toggle">
				    <input type="checkbox" class="check">
				      <div id="lightSwitch" class="switch lightSwitch"></div>
				      <div class="track lightTrack"></div>
				  </div>
			   </div>
			</div>
			<div class="canvas_container">
			   <canvas id="c1" width="600" height="500"></canvas>
			</div>
		</div>
	</div>
	<script>
		var canvas, circle;
		var shadowYellow, shadowBlack; 

		$(document).ready(function () {
			resizeCanvas();
			canvas = new fabric.Canvas('c1');
			shadowYellow = new fabric.Shadow({ 
			    color: 'yellow', 
			    blur: 50,
			    // offsetX: 10,
			    // offsetY: 10,
			    // opacity: 0.5,
			});
			shadowBlack = new fabric.Shadow({ 
			    color: 'black', 
			    blur: 20,
			    // offsetX: 10,
			    // offsetY: 10,
			    opacity: 0.7,
			});
			circle = new fabric.Circle({ 
				radius: 100, 
				fill: '#FFD700',
				strokeWidth: 20,
				stroke: "rgb(218,165,32)",
				opacity: 0.7,
				top: 150,
				shadow: shadowBlack
			});
			canvas.add(circle);
			checkScale();
			canvas.centerObject(circle);
			canvas.renderAll();
			canvas.on('object:moving', function (e) {
			        var obj = e.target;
			         // if object is too big ignore
			        if(obj.currentHeight > obj.canvas.height || obj.currentWidth > obj.canvas.width){
			            return;
			        }        
			        obj.setCoords();        
			        // top-left  corner
			        if(obj.getBoundingRect().top < 0 || obj.getBoundingRect().left < 0){
			            obj.top = Math.max(obj.top, obj.top-obj.getBoundingRect().top);
			            obj.left = Math.max(obj.left, obj.left-obj.getBoundingRect().left);
			        }
			        // bot-right corner
			        if(obj.getBoundingRect().top+obj.getBoundingRect().height  > obj.canvas.height || obj.getBoundingRect().left+obj.getBoundingRect().width  > obj.canvas.width){
			            obj.top = Math.min(obj.top, obj.canvas.height-obj.getBoundingRect().height+obj.top-obj.getBoundingRect().top);
			            obj.left = Math.min(obj.left, obj.canvas.width-obj.getBoundingRect().width+obj.left-obj.getBoundingRect().left);
			        }
			});

			    var left1 = 0;
			    var top1 = 0 ;
			    var scale1x = 0 ;    
			    var scale1y = 0 ;    
			    var width1 = 0 ;    
			    var height1 = 0 ;
			  canvas.on('object:scaling', function (e){
			    var obj = e.target;
			    obj.setCoords();
			    var brNew = obj.getBoundingRect();
			    
			    if (((brNew.width+brNew.left)>=obj.canvas.width) || ((brNew.height+brNew.top)>=obj.canvas.height) || ((brNew.left<0) || (brNew.top<0))) {
			    obj.left = left1;
			    obj.top=top1;
			    obj.scaleX=scale1x;
			    obj.scaleY=scale1y;
			    obj.width=width1;
			    obj.height=height1;
			  }
			    else{    
			      left1 =obj.left;
			      top1 =obj.top;
			      scale1x = obj.scaleX;
			      scale1y=obj.scaleY;
			      width1=obj.width;
			      height1=obj.height;
			    }
			 });
		});

		// $(window).on('resize', function() {
		// 	resizeCanvas();
		// 	checkScale();
		// })

		var ratio = 0.3
		function checkScale(e) {
			var canWidth = $('#c1').width();
			var canHeight = $('#c1').height();
			var adjCircle = Math.floor(canWidth * ratio);
			var adjStroke = Math.floor(circle.strokeWidth * ratio);
			circle.set("radius", adjCircle);
			circle.set("strokeWidth", adjStroke);
			console.log(ratio, canWidth, canHeight, adjCircle);
		}

		var resizeCanvas = function() {
			var canvasId = $('#c1');
			canvasId.attr('width', $('.canvas_container').width() ); //max width
			canvasId.attr('height', $('.canvas_container').height() ); //max height
			$('.toolbar__canvas').css('height', $('.canvas_container').height() );
		}

		var toggle = document.getElementById('toggle');
		var lightSwitch = document.getElementById('lightSwitch');
		var toggleState = false;

		function getActiveShadow(name) {
		    var object = canvas.getActiveObject();
		    if (!object) return '';

		    return object[name] || '';
		}

		function setActiveShadow(name, value) {
		    var object = canvas.getActiveObject();
		    if (!object) return;
		    if(object.shadow)
		    	object.shadow[name] = value;
		    else{
		    	var ob = {};
		    	ob[name] = value;
		    	object.setShadow(ob);
		    }
		    
		    object.setCoords();
		}

		var shadowify = function (colorCode) {
		    var obj = canvas.getActiveObject();
		    if (!obj) return;

		    if (obj.shadow) {
		        obj.shadow = null;
		    } else {
		        obj.setShadow({
		            color: colorCode,
		            blur: 50,
		            // offsetX: 10,
		            // offsetY: 10
		        });
		    }
		    canvas.renderAll();
		};

		var setShadowBlur = function () {
		    setActiveShadow('blur', 20);
		    canvas.renderAll();
		};

		function backgroundToggle() {
			if (toggleState === false) {
				$('#c1').addClass('off');
				// shadowify("#000000");
				// setShadowBlur();
				circle.set("shadow", shadowYellow);
				canvas.renderAll();
				toggleState = true
			} else {
				$('#c1').removeClass('off');
				// shadowify("#FFFF00");
				// setShadowBlur();
				circle.set("shadow", shadowBlack);
				canvas.renderAll();
				toggleState = false
			}
			// $('#c1').css({'background-color':'black'});
			// canvasId.attr('background', $('.canvas_container').width() );
			// document.body.classList.toggle('off');
			lightSwitch.classList.toggle('move');
			toggle.classList.toggle('toggle-border');
		}
		toggle.onclick = backgroundToggle;

		$('#btn_color_palette').on('change', ()=>{
		  canvas.setBackgroundColor($('input#color').val())
		  canvas.renderAll();
		})
	</script>
  </body>
</html>
